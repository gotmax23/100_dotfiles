#!/bin/bash

# Copyright 2010 Ankur Sinha 
# Author: Ankur Sinha <sanjay DOT ankur AT gmail DOT com> 
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
# File : syncPhone.sh
#

MEMCARD_MOUNT=$(mount | egrep gvfs | egrep 1000 | awk '{print $3}')
TOMDROID="${MEMCARD_MOUNT}""/tomdroid/"
#RECORDINGS="${MEMCARD_MOUNT}""/EasyVoiceRecorder/"
#RECORDINGS_LOCAL="${HOME}""/Documents/readables/reference/research_papers/recordings/"

function recordingsRename ()
{
    # remove spaces in names, eat babies!
    for i in {1..10}; 
    do 
        rename -v " " "-" * ;
    done 

    # rename the files
    for i in `ls My*`;
    do 
        Accesstime=$(ls --full-time "${i}" | awk '{print $6}'); 
        checkSUM=$(md5sum "${i}" | awk '{print $1}'); 
        newName="${Accesstime}-${checkSUM}.wav"; 
        mv "${i}" "${newName}" -v;  
    done
}

function main()
{
    if [ -e "${MEMCARD_MOUNT}" ] && [ -d "${MEMCARD_MOUNT}" ] && [ `mount | egrep "${MEMCARD_MOUNT}" | wc -l` -gt 0 ] ; 
    then
        echo "DEBUG: Memory card appears to be mounted"
        echo "DEBUG: Syncing phone with system"
        echo "DEBUG: Tomdroid"

        pushd "$HOME""/.local/share/gnote/"

        echo -e "\nDEBUG: Transferring 0979fd77-a3cd-4d3e-9b42-a327c989d244.note"
        rsync -avPh "0979fd77-a3cd-4d3e-9b42-a327c989d244.note" "$TOMDROID"
        echo -e "\nDEBUG: Transferring e7453585-a26f-4ac0-b5e9-396ba2549c84.note"
        rsync -avPh "e7453585-a26f-4ac0-b5e9-396ba2549c84.note" "$TOMDROID"
        echo -e "\nDEBUG: Transferring 772855f5-98d2-4908-b75f-6eff8124fc1a.note"
        rsync -avPh "772855f5-98d2-4908-b75f-6eff8124fc1a.note" "$TOMDROID"
        echo -e "\nDEBUG: Transferring 5e73ae6e-651e-461e-bf77-411b61e7aeca.note"
        rsync -avPh "5e73ae6e-651e-461e-bf77-411b61e7aeca.note" "$TOMDROID"
        echo -e "\nDEBUG: Transferring e0e844e7-07fc-4701-943f-fb96037e2d98.note"
        rsync -avPh "e0e844e7-07fc-4701-943f-fb96037e2d98.note" "$TOMDROID"
        echo -e "\nDEBUG: Transferring 9c2ebce2-e2dd-4a23-8234-7df2b87e16fa.note"
        rsync -avPh "9c2ebce2-e2dd-4a23-8234-7df2b87e16fa.note" "$TOMDROID"
        echo -e "\nDEBUG: Transferring 9ac8fa69-436e-45f5-83c8-ff11073957b4.note"
        rsync -avPh "9ac8fa69-436e-45f5-83c8-ff11073957b4.note" "$TOMDROID"
        echo -e "\nDEBUG: Transferring 8ab5e7d8-1b9b-474c-88d4-874855e6c9f1.note"
        rsync -avPh "8ab5e7d8-1b9b-474c-88d4-874855e6c9f1.note" "$TOMDROID"
        echo -e "\nDEBUG: Transferring 4711a01e-745a-4fdf-8b4f-6dfc2ac5f643.note"
        rsync -avPh "4711a01e-745a-4fdf-8b4f-6dfc2ac5f643.note" "$TOMDROID"
        echo -e "\nDEBUG: Transferring db8eaf95-2d2f-4c11-8a04-a6e0e4c51495.note"
        rsync -avPh "db8eaf95-2d2f-4c11-8a04-a6e0e4c51495.note" "$TOMDROID"

        popd

        sleep 2;

        #cd "${RECORDINGS}"
        #echo "DEBUG: Entered recordings directory"
        #echo "DEBUG: Renaming"
        #recordingsRename
        #cd "${HOME}"

        #echo "DEBUG: Fetching recordings"
        #rsync -avPh "${RECORDINGS}" "${RECORDINGS_LOCAL}"
    else
        echo "DEBUG: Memory card not mounted!"
        exit 1

    fi

}

main

exit 0
